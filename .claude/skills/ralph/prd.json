{
  "project": "obsidian-workout-plugin",
  "branchName": "ralph/dynamic-exercise-types",
  "description": "Dynamic Exercise Types - Support different exercise types with custom parameters (time-based, distance, cardio, custom)",
  "userStories": [
    {
      "id": "US-001",
      "title": "Define Exercise Type Schema Interface",
      "description": "As a developer, I need TypeScript interfaces to represent exercise type definitions so the system can understand what parameters each exercise requires.",
      "acceptanceCriteria": [
        "Create ExerciseTypeDefinition interface in app/types/ExerciseTypes.ts with: id (string), name (string), parameters (ParameterDefinition[])",
        "Create ParameterDefinition interface with: key, label, type ('number'|'string'|'boolean'), unit?, required, default?, min?, max?",
        "Create ExerciseDefinition interface with: name, typeId, muscleGroups?, customParameters?",
        "Export interfaces from barrel file app/types/index.ts",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Completed 2026-01-29: Created ExerciseTypes.ts with ParameterDefinition, ExerciseTypeDefinition, and ExerciseDefinition interfaces. Exported from barrel file."
    },
    {
      "id": "US-002",
      "title": "Create Built-in Exercise Type Definitions",
      "description": "As a user, I want predefined exercise types (Strength, Timed, Distance, Cardio, Custom) so I can quickly create common exercises without manual configuration.",
      "acceptanceCriteria": [
        "Create app/constants/exerciseTypes.constants.ts with built-in types: Strength (reps+weight), Timed (duration), Distance (distance+optional duration), Cardio (duration+optional distance/heartRate), Custom (no predefined params)",
        "Export BUILT_IN_EXERCISE_TYPES: ExerciseTypeDefinition[] array",
        "Export getExerciseTypeById(id: string): ExerciseTypeDefinition | undefined helper function",
        "Update app/constants/index.ts barrel to export new constants",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Completed 2026-01-29: Created exerciseTypes.constants.ts with 5 built-in types (Strength, Timed, Distance, Cardio, Custom), EXERCISE_TYPE_IDS enum, BUILT_IN_EXERCISE_TYPES array, getExerciseTypeById helper, and DEFAULT_EXERCISE_TYPE_ID. Exported from barrel."
    },
    {
      "id": "US-003",
      "title": "Create ExerciseDefinitionService",
      "description": "As a developer, I need a service to load, save, and manage exercise definitions from exercise folder .md frontmatter files.",
      "acceptanceCriteria": [
        "Create app/services/ExerciseDefinitionService.ts with: getExerciseDefinition(name), getAllExerciseDefinitions(), saveExerciseDefinition(definition), getParametersForExercise(name)",
        "Parse exercise_type field from frontmatter (default: 'strength' for backward compatibility)",
        "Parse parameters field from frontmatter as YAML array for custom parameters",
        "Cache definitions with 10-second TTL (similar to DataService pattern)",
        "Register service in main.ts plugin initialization",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Completed 2026-01-29: Created ExerciseDefinitionService.ts with all required methods. Service parses exercise_type and parameters from frontmatter YAML. Uses 10-second cache TTL with race condition prevention. Added getExerciseType() and getParametersForExercise() helpers. Registered in main.ts with cleanup in onunload(). Exposed via getExerciseDefinitionService() getter."
    },
    {
      "id": "US-004",
      "title": "Extend CSV Schema for Dynamic Columns",
      "description": "As a developer, I need the CSV interfaces and parser to support dynamic columns so new exercise parameters can be stored.",
      "acceptanceCriteria": [
        "Update WorkoutLogData interface to include customFields?: Record<string, string | number | boolean>",
        "Update CSVWorkoutLogEntry interface similarly",
        "Modify parseCSVLogFile() in WorkoutLogData.ts to read CSV header dynamically and map unknown columns to customFields",
        "Modify formatCSVLogEntry() to write known columns first, then custom field columns",
        "Ensure empty/null values written as empty string (nullable columns)",
        "Backward compatible: existing CSVs with only standard columns still work",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Completed 2026-01-29: Added customFields to both WorkoutLogData and CSVWorkoutLogEntry interfaces. Added STANDARD_CSV_COLUMNS constant. Updated parseCSVLogFile() to detect custom columns from header and parse values as number/boolean/string. Updated entryToCSVLine() to accept custom columns and write them. Updated entriesToCSVContent() to build header dynamically. Added collectCustomColumns() helper. All 42 WorkoutLogData tests pass including 17 new custom fields tests."
    },
    {
      "id": "US-005",
      "title": "Extend DataService for Dynamic Column Management",
      "description": "As a developer, I need DataService to handle CSV files with varying columns and add new columns when needed.",
      "acceptanceCriteria": [
        "Add method getCSVColumns(): Promise<string[]> to return current CSV header columns",
        "Add method ensureColumnExists(columnName: string): Promise<void> to add column if missing",
        "Modify addWorkoutLogEntry() to check entry customFields for new columns, call ensureColumnExists() before writing",
        "Modify updateWorkoutLogEntry() similarly for new columns",
        "Clear cache after column structure changes",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Completed 2026-01-29: Added getCSVColumns() method to read CSV header columns, ensureColumnExists() method to add new custom columns dynamically. Updated addWorkoutLogEntry() and updateWorkoutLogEntry() to call ensureColumnExists() for each custom field before writing. Cache is cleared after column structure changes. Added 12 new tests covering all acceptance criteria. All 397 tests pass."
    },
    {
      "id": "US-006",
      "title": "Update CreateExercisePageModal for Exercise Types",
      "description": "As a user, I want to select an exercise type when creating a new exercise so the system knows what parameters to track.",
      "acceptanceCriteria": [
        "Add exercise type dropdown to CreateExercisePageModal after exercise name input showing: Strength, Timed, Distance, Cardio, Custom",
        "When 'Custom' selected, show UI to add custom parameters: 'Add Parameter' button with key/label/type/unit/required inputs",
        "Update exercise page template to include exercise_type in frontmatter",
        "Update exercise page template to include parameters in frontmatter for custom type",
        "Default selection: 'Strength' for backward compatibility",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Completed 2026-01-29: Added exercise type dropdown with 5 options (Strength, Timed, Distance, Cardio, Custom). Custom type shows dynamic parameter builder UI with Add/Remove buttons, key/label/type/unit/required inputs. Updated frontmatter template to include exercise_type field and parameters array for custom types. Added UI constants for labels, placeholders, and select options. Added CSS styles for custom parameters section. Default selection is 'Strength' for backward compatibility. All 397 tests pass. Browser verification pending."
    },
    {
      "id": "US-007",
      "title": "Update CreateLogModal for Dynamic Fields",
      "description": "As a user creating a log entry, I want the form to show fields based on the exercise type, so I can enter the correct data for that type of exercise.",
      "acceptanceCriteria": [
        "CreateLogModal fetches exercise definition when exercise is selected or pre-populated",
        "Modal renders input fields based on exercise type's parameter definitions",
        "Fields use correct input type (number/text/checkbox) and validation (min/max/required)",
        "For exercises without type definitions, default to strength type fields (reps, weight)",
        "Custom parameter values are saved in WorkoutLogData.customFields",
        "Form validation respects required parameters",
        "Legacy logs without customFields continue to work",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 7,
      "passes": true
    },
    {
      "id": "US-008",
      "title": "Update EditLogModal for Dynamic Fields",
      "description": "As a user, I want to edit log entries and see the correct fields for that exercise's type.",
      "acceptanceCriteria": [
        "Load exercise definition when modal opens using ExerciseDefinitionService",
        "Populate form fields from both standard fields and customFields",
        "Same dynamic field rendering as CreateLogModal (US-007)",
        "Preserve all field values on save including customFields",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 8,
      "passes": true,
      "notes": "Completed 2026-01-29: Updated EditLogModal.getPreFillData() to include customFields from originalLog. Added renderParameterField() helper to BaseLogModal for creating dynamic input fields (number/boolean/string types). Updated createFormElements() to load exercise definition and render custom parameter fields when exercise name is known. Updated preFillForm() to populate custom fields from LogFormData. All 397 tests pass and typecheck passes."
    },
    {
      "id": "US-009",
      "title": "Update TableRenderer for Dynamic Columns",
      "description": "As a user, I want tables to show columns relevant to each exercise type automatically.",
      "acceptanceCriteria": [
        "TableRenderer reads exercise definition for filtered exercise",
        "If single exercise filter: show only that exercise's parameter columns",
        "If multiple exercises: show union of all parameter columns with empty cells for missing params",
        "Column headers use parameter labels with units in parentheses, e.g., 'Duration (sec)'",
        "Support explicit columns config to override automatic detection",
        "Default columns for no filter: Date, Exercise, Reps, Weight, Volume (backward compatible)",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Update ChartRenderer for Dynamic Data Types",
      "description": "As a user, I want charts to visualize the appropriate metric for each exercise type.",
      "acceptanceCriteria": [
        "ChartRenderer reads exercise definition for filtered exercise",
        "Determine available chart data types from exercise parameters: strength->volume/weight/reps, timed->duration, distance->distance/duration/pace, custom->all numeric params",
        "Update type parameter to accept any numeric parameter key not just volume/weight/reps",
        "Default type based on exercise type: strength->volume, timed->duration, distance->distance",
        "Show error message if requested type not available for exercise",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 10,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "Update InsertChartModal for Dynamic Types",
      "description": "As a user, I want the chart insert modal to show valid data type options based on the selected exercise.",
      "acceptanceCriteria": [
        "When exercise selected, fetch its ExerciseDefinition",
        "Update 'Data Type' dropdown to show only valid options for that exercise type",
        "Update preview to reflect selected exercise's available chart types",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 11,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-012",
      "title": "Add Exercise Type Migration Utility",
      "description": "As a user with existing data, I want my current exercises to work without modification, with optional migration command.",
      "acceptanceCriteria": [
        "Exercises without exercise_type frontmatter default to 'strength'",
        "CSV entries without customFields work with standard reps/weight parsing",
        "Add optional command 'Migrate Exercise Types' that scans exercise folder, adds exercise_type: strength to files missing it, reports count of updated files",
        "Typecheck passes"
      ],
      "priority": 12,
      "passes": false,
      "notes": ""
    }
  ]
}
