{
  "project": "obsidian-workout-plugin",
  "branchName": "ralph/phase3-advanced-features",
  "description": "Phase 3 - Advanced Features: Protocol tracking for specialized workout techniques and workout duration estimation",
  "userStories": [
    {
      "id": "US-001",
      "title": "Add Protocol Field to Log Entry",
      "description": "As a user, I want to select a workout protocol when logging so that my advanced techniques are tracked structurally.",
      "acceptanceCriteria": [
        "Add WorkoutProtocol enum to app/types with values: STANDARD, DROP_SET, MYO_REPS, REST_PAUSE, SUPERSET, TWENTYONE",
        "Add 'protocol' column to CSV schema in WorkoutLogData.ts (default: 'standard', backward compatible)",
        "CreateLogModal includes 'Protocol' dropdown populated from enum",
        "Default selection: Standard",
        "Protocol value saved to CSV when logging entry",
        "Existing CSV entries without protocol column parse correctly (default to 'standard')",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Completed 2026-01-26. WorkoutProtocol enum added, CSV schema updated with protocol column (10th column), CreateLogModal and EditLogModal updated with Protocol dropdown. All tests pass (352 passed)."
    },
    {
      "id": "US-002",
      "title": "Display Protocol in Log Table",
      "description": "As a user, I want to see which protocol was used for each logged set so that I can review my training variety.",
      "acceptanceCriteria": [
        "Protocol column added to workout-log table in TableRenderer",
        "Column shows protocol badge with distinct styling per protocol type",
        "Standard protocol shows no badge (clean default view)",
        "Column is hideable via 'showProtocol: false' parameter in code block",
        "Badge colors work in both light and dark themes",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Completed 2026-01-27. Protocol column added to TableRenderer with badge styling. Protocol badges display with distinct colors per protocol type (Drop=red, Myo=purple, RP=orange, SS=blue, 21s=green). Standard protocol shows no badge. Column hideable via showProtocol: false parameter. All tests pass (356 total, 352 passed)."
    },
    {
      "id": "US-003",
      "title": "Filter Log by Protocol",
      "description": "As a user, I want to filter my workout log by protocol so that I can analyze specific technique usage.",
      "acceptanceCriteria": [
        "'protocol' parameter accepted in workout-log code blocks",
        "Filter accepts single protocol string (e.g., protocol: drop_set)",
        "Filter accepts array of protocols (e.g., protocol: [drop_set, myo_reps])",
        "Works in combination with existing exercise and workout filters",
        "DataFilter updated to support protocol filtering",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Completed 2026-01-27. Added protocol parameter to EmbeddedTableParams. Enhanced CodeBlockProcessorService to parse array syntax [value1, value2]. Implemented filterByProtocol() in DataFilter with AND logic for combining with exercise/workout filters. Protocol filter supports single string or array of protocols (OR within protocols). Case-insensitive matching. Entries without protocol default to STANDARD. All tests pass (368 passed, 16 new tests added for protocol filtering and array parsing)."
    },
    {
      "id": "US-004",
      "title": "Add Custom Protocol Settings",
      "description": "As a user, I want to add my own protocols so that I can track techniques not in the default list.",
      "acceptanceCriteria": [
        "Settings tab includes 'Custom Protocols' section",
        "Can add new protocol with: name, abbreviation (3 chars max), color",
        "Can edit existing custom protocols",
        "Can delete custom protocols",
        "Custom protocols saved to plugin settings (customProtocols array)",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Completed 2026-01-27. Added CustomProtocolConfig interface to WorkoutLogData.ts with fields: id, name, abbreviation (max 3 chars), color. Added customProtocols array to WorkoutChartsSettings. Implemented Custom Protocols section in settings tab with add/edit/delete functionality. Protocol editor includes color picker, auto-generated ID from name, and badge preview. All tests pass (368 passed, 4 skipped)."
    },
    {
      "id": "US-005",
      "title": "Integrate Custom Protocols in Log Modal",
      "description": "As a user, I want my custom protocols to appear in the CreateLogModal dropdown alongside built-in protocols.",
      "acceptanceCriteria": [
        "CreateLogModal Protocol dropdown shows built-in protocols first, then custom protocols",
        "Custom protocols display with their configured abbreviation and color",
        "Custom protocol selection saves to CSV correctly",
        "Custom protocols display correctly in log table",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Completed 2026-01-27. Modified BaseLogModal.ts to dynamically build protocol dropdown options from both built-in protocols (CONSTANTS.WORKOUT.MODAL.SELECT_OPTIONS.PROTOCOL) and custom protocols (plugin.settings.customProtocols). Updated TableRenderer.ts renderProtocolBadge() method to handle custom protocols by checking plugin.settings.customProtocols and rendering badges with custom colors and abbreviations. Added getContrastColor() helper for text accessibility. Added CSS class .workout-protocol-badge-custom for custom badge styling. All tests pass (368 passed, 4 skipped)."
    },
    {
      "id": "US-006",
      "title": "Protocol Statistics Dashboard Card",
      "description": "As a user, I want to see protocol usage statistics in my dashboard so that I understand my training distribution.",
      "acceptanceCriteria": [
        "Dashboard includes 'Protocol Distribution' card in EmbeddedDashboardView",
        "Shows pie chart of protocol usage for last 30 days",
        "Shows count and percentage per protocol",
        "Pie chart uses accessible patterns in addition to colors",
        "Standard protocol included in distribution",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Completed 2026-01-27. Created ProtocolDistribution widget with pie chart using Chart.js. Widget displays protocol usage statistics for last 30 days with count and percentage for each protocol. Supports both built-in protocols (Standard, Drop Set, Myo Reps, Rest Pause, Superset, 21s) and custom protocols from settings. Pie chart with distinct colors per protocol, legend shows counts and percentages. Standard protocol included in distribution. Added SCSS styles in _protocol.scss. All tests pass (368 passed, 4 skipped)."
    },
    {
      "id": "US-007",
      "title": "Protocol Dashboard Click Filtering",
      "description": "As a user, I want to click on a pie chart slice to filter recent workouts by that protocol.",
      "acceptanceCriteria": [
        "Clicking pie chart slice updates dashboard to show only that protocol's entries",
        "Filter state shown visually (active filter indicator)",
        "Click again or click 'clear' to remove filter",
        "Filtered view updates all dashboard sections that support protocol filtering",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 7,
      "passes": true,
      "notes": "Completed 2026-01-27. Added click handlers to pie chart slices and legend items in ProtocolDistribution widget. Chart.js onClick callback triggers filter change. Filter state stored in EmbeddedDashboardParams.activeProtocolFilter. Visual feedback includes: dimmed non-active slices, highlighted active slice border, active legend item styling, filter indicator bar with protocol badge and clear button. Dashboard re-renders with filtered data for all widgets (SummaryWidget, QuickStatsCards, VolumeAnalytics, MuscleHeatMap, RecentWorkouts). Toggle behavior: clicking same protocol clears filter. All tests pass (368 passed, 4 skipped)."
    },
    {
      "id": "US-008",
      "title": "Protocol Effectiveness Analysis",
      "description": "As a user, I want to see if certain protocols correlate with better progression so that I can optimize my training.",
      "acceptanceCriteria": [
        "Dashboard includes 'Protocol Effectiveness' section",
        "Shows average volume increase per protocol type (comparing sets before/after)",
        "Shows progression rate comparison between protocols",
        "Includes disclaimer text: 'Note: Correlation does not imply causation'",
        "Only shows protocols with sufficient data (minimum 5 entries)",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 8,
      "passes": true,
      "notes": "Completed 2026-01-27. Created ProtocolEffectiveness widget displaying protocol effectiveness statistics in dashboard. Widget calculates avg volume change (comparing entries before/after using protocol) and progression rate (percentage of sets followed by same or higher weight). Displays as table with Protocol, Entries, Avg Volume Change (with +/- color coding), and Progression Rate columns. Only shows protocols with minimum 5 entries. Includes disclaimer 'Note: Correlation does not imply causation' with warning styling. Added PROTOCOL_EFFECTIVENESS constants. Added SCSS styles in _protocol.scss with table styling and color-coded indicators. All tests pass (368 passed, 4 skipped)."
    },
    {
      "id": "US-009",
      "title": "Workout Duration Estimator Code Block",
      "description": "As a user, I want to see estimated workout duration so that I can plan my gym time.",
      "acceptanceCriteria": [
        "Register 'workout-duration' code block processor in CodeBlockProcessorService",
        "Create EmbeddedDurationView extending BaseView",
        "Calculates total rest time by summing workout-timer durations in current file",
        "Calculates total set time using setDuration setting (default 45 seconds)",
        "Displays: total rest time, total set time, total estimated duration",
        "Visual design distinct from timer (e.g., info card style, not countdown)",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 9,
      "passes": true,
      "notes": "Completed 2026-01-27. Added DURATION constant to CODE_BLOCKS in Constants.ts. Created DurationTypes.ts with EmbeddedDurationParams and DurationAnalysisResult interfaces. Implemented EmbeddedDurationView extending BaseView with createDurationEstimator() method that scans workout files for workout-timer blocks, sums durations for rest time, and calculates set time (setCount * setDuration setting, default 45s). Registered workout-duration code block processor in CodeBlockProcessorService. Created _duration.scss with info card styling (distinct from timer countdown). Supports debug parameter for troubleshooting. All tests pass (368 passed, 4 skipped)."
    },
    {
      "id": "US-010",
      "title": "Duration Estimator Settings",
      "description": "As a user, I want to configure the default set duration used in estimation.",
      "acceptanceCriteria": [
        "Add 'setDuration' field to plugin settings (number, default 45)",
        "Settings tab includes 'Default Set Duration (seconds)' input",
        "EmbeddedDurationView uses this setting for calculations",
        "Input validates for positive numbers only",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": true,
      "notes": "Completed 2026-01-27. Added setDuration field to WorkoutChartsSettings interface and DEFAULT_SETTINGS (default: 45 seconds). Added 'Duration estimation' section in Settings tab with 'Default set duration (seconds)' text input. Input validates for positive integers only before saving. Updated EmbeddedDurationView to use typed setting (removed type assertion). Updated DataService test mock to include setDuration. All tests pass (368 passed, 4 skipped)."
    },
    {
      "id": "US-011",
      "title": "Duration Estimator Workout Parameter",
      "description": "As a user, I want to estimate duration for a specific workout file so that I can use this widget on any page.",
      "acceptanceCriteria": [
        "'workout' parameter specifies which file to analyze (relative or absolute path)",
        "Scans specified file for workout-timer blocks to sum rest times",
        "Counts sets from workout-log blocks in specified file",
        "Defaults to current file if workout parameter not specified",
        "Shows error message if specified file not found",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-012",
      "title": "Actual Duration Tracking",
      "description": "As a user, I want to track actual workout duration so that I can compare estimated vs real time.",
      "acceptanceCriteria": [
        "Dashboard includes 'Duration Comparison' section",
        "Calculates actual duration from first log timestamp to last log timestamp per workout session",
        "Shows estimated vs actual for 5 most recent workouts",
        "Shows variance trend (are estimates getting more accurate?)",
        "Handles timezone correctly using stored timestamps",
        "Typecheck passes",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 12,
      "passes": false,
      "notes": ""
    }
  ]
}
