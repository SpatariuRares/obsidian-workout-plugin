# Ralph Progress Log

## 2026-01-24 - US-001: Add TimerPresetConfig type and settings field

**Status:** Completed

**Changes made:**
1. Added `TimerPresetConfig` interface to `app/types/TimerTypes.ts` with fields:
   - `name: string`
   - `type: TIMER_TYPE`
   - `duration: number`
   - `showControls: boolean`
   - `autoStart: boolean`
   - `sound: boolean`
   - `intervalTime?: number` (optional, for interval timers)
   - `rounds?: number` (optional, for interval timers)

2. Exported `TimerPresetConfig` from `app/types/index.ts`

3. Updated `WorkoutChartsSettings` in `app/types/WorkoutLogData.ts` with:
   - `timerPresets: Record<string, TimerPresetConfig>`
   - `defaultTimerPreset: string | null`

4. Updated `DEFAULT_SETTINGS` in `app/types/WorkoutLogData.ts` with:
   - `timerPresets: {}`
   - `defaultTimerPreset: null`

**Notes for next developer:**
- TypeScript compilation passes
- Pre-existing test failures unrelated to this change:
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- Next task is US-002: Add Timer Presets UI to settings tab

## 2026-01-24 - US-002: Add Timer Presets UI to settings tab

**Status:** Completed

**Changes made:**
1. Updated `app/constants/Constants.ts` with new settings labels, descriptions, buttons, and messages for timer presets:
   - Labels: TIMER_PRESETS, DEFAULT_TIMER_PRESET, PRESET_NAME, PRESET_TYPE, PRESET_DURATION, etc.
   - Descriptions: TIMER_PRESETS, DEFAULT_TIMER_PRESET, NO_PRESETS
   - Sections: TIMER_PRESETS
   - Buttons: ADD_PRESET, DELETE_PRESET, SAVE_PRESET, CANCEL
   - Messages: PRESET_NAME_REQUIRED, PRESET_NAME_EXISTS, PRESET_DELETED, PRESET_SAVED, CONFIRM_DELETE_PRESET

2. Completely rewrote `app/features/settings/WorkoutChartsSettings.ts` to include Timer Presets UI:
   - Added `renderTimerPresetsSection()` method with section heading
   - Added Default Timer Preset dropdown with "None" option + all existing presets
   - Added `renderPresetsList()` to display all configured presets with edit/delete buttons
   - Added `renderPresetItem()` to display individual preset with formatted details
   - Added `formatPresetDetails()` to format preset config as readable string
   - Added `showPresetEditor()` for inline preset editing (supports both create and edit)
   - Added `savePreset()` with name validation and duplicate checking
   - Added `deletePreset()` with cleanup of default preset reference if needed
   - Editor conditionally shows interval-specific fields (intervalTime, rounds) only for interval timer type

**Features implemented:**
- Settings tab includes 'Timer Presets' section
- Can add a new preset with name input and all configuration fields
- Can edit existing presets inline (clicking pencil icon)
- Can delete presets with confirmation dialog
- Default Timer Preset dropdown shows available presets plus 'None' option
- Presets persist across plugin reloads via plugin.saveSettings()
- Dynamic form that shows/hides interval-specific fields based on timer type

**Notes for next developer:**
- TypeScript compilation passes
- Pre-existing test failures remain (unrelated to this change)
- Next task is US-003: Add preset parameter to workout-timer blocks

## 2026-01-24 - US-003: Add preset parameter to workout-timer blocks

**Status:** Completed

**Changes made:**
1. Updated `app/types/TimerTypes.ts`:
   - Added optional `preset?: string` parameter to `EmbeddedTimerParams` interface

2. Updated `app/views/EmbeddedTimerView.ts`:
   - Added import for `TimerPresetConfig`
   - Added `resolveTimerParams()` method that implements parameter resolution:
     - Checks for explicitly specified preset in code block params
     - Falls back to default preset from settings if no explicit preset
     - Merges preset params with explicit params (explicit override preset)
   - Added `presetToParams()` helper to convert TimerPresetConfig to EmbeddedTimerParams
   - Added `filterUndefined()` helper for proper parameter merging
   - Added `renderPresetError()` to display error when preset not found
   - Updated `createTimer()` to use resolved parameters

**Resolution order implemented:**
1. Explicit parameters from code block
2. Parameters from specified preset (if preset parameter provided)
3. Parameters from default preset (if configured in settings)
4. Hardcoded defaults (TIMER_TYPE.COUNTDOWN, 300 seconds, etc.)

**Usage example:**
```
workout-timer
preset: My Rest Timer
duration: 60
```
This will use "My Rest Timer" preset as base, but override duration to 60 seconds.

**Notes for next developer:**
- TypeScript compilation passes
- Pre-existing test failures remain (unrelated to this change):
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- Next task is US-004: Change DEFAULT_EXACT_MATCH to true

## 2026-01-24 - US-004: Change DEFAULT_EXACT_MATCH to true

**Status:** Completed

**Changes made:**
1. Updated `app/constants/Constants.ts`:
   - Added `CONSTANTS.WORKOUT.TABLE.DEFAULTS.EXACT_MATCH = true`
   - Added `CONSTANTS.WORKOUT.SETTINGS.LABELS.DEFAULT_EXACT_MATCH`
   - Added `CONSTANTS.WORKOUT.SETTINGS.DESCRIPTIONS.DEFAULT_EXACT_MATCH`
   - Added `CONSTANTS.WORKOUT.SETTINGS.SECTIONS.FILTERING`

2. Updated `app/types/WorkoutLogData.ts`:
   - Added `defaultExactMatch: boolean` field to `WorkoutChartsSettings` interface
   - Added `defaultExactMatch: true` to `DEFAULT_SETTINGS`

3. Updated `app/features/settings/WorkoutChartsSettings.ts`:
   - Added new "Filtering" section with toggle for "Default exact match" setting
   - Toggle saves to `plugin.settings.defaultExactMatch`

4. Updated `app/features/modals/InsertChartModal.ts`:
   - Changed `exactMatchToggle.checked = true` to use `plugin.settings.defaultExactMatch`

5. Updated `app/features/modals/InsertTableModal.ts`:
   - Changed `exactMatchToggle.checked = true` to use `plugin.settings.defaultExactMatch`

6. Updated `app/features/tables/business/TableConfig.ts`:
   - Changed `exactMatch: false` to `exactMatch: CONSTANTS.WORKOUT.TABLE.DEFAULTS.EXACT_MATCH`

**Features implemented:**
- exactMatch defaults to `true` across the codebase
- New "Filtering" section in settings with "Default exact match" toggle
- Modals use the setting value for their default checkbox state
- Existing code blocks with explicit `exactMatch: false` continue to work unchanged

**Notes for next developer:**
- TypeScript compilation passes
- Pre-existing test failures remain (unrelated to this change):
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- Next task is US-005: Create Audit Exercise Names command and modal

## 2026-01-24 - US-005: Create Audit Exercise Names command and modal

**Status:** Completed

**Changes made:**
1. Created `app/features/modals/AuditExerciseNamesModal.ts`:
   - Extends `ModalBase` for consistent modal behavior
   - `scanExerciseFiles()` method scans exercise folder and compares filenames against CSV exercise names
   - Uses existing `getMatchScore()` utility from `app/utils/utils.ts` for fuzzy matching (0-100 similarity scores)
   - `renderResults()` displays results in a table with columns: File name, CSV exercise, Similarity, Status
   - File names are clickable links that open the exercise file
   - Results sorted by score (worst matches first)
   - Shows success message when no mismatches found

2. Updated `app/constants/Constants.ts`:
   - Added `COMMANDS.AUDIT_EXERCISE_NAMES: "Audit exercise names"`
   - Added `MODAL.TITLES.AUDIT_EXERCISE_NAMES: "Audit exercise names"`
   - Added `MODAL.LABELS.FILE_NAME`, `CSV_EXERCISE`, `SIMILARITY`, `STATUS`
   - Added `MODAL.NOTICES.AUDIT_NO_MISMATCHES` and `AUDIT_SCANNING`

3. Updated `app/services/CommandHandlerService.ts`:
   - Imported `AuditExerciseNamesModal`
   - Registered `audit-exercise-names` command that opens the modal

4. Updated `app/styles/_modal.scss`:
   - Added `.workout-audit-success` styling for success message
   - Added `.workout-audit-table-container` with max-height and scrolling
   - Added `.workout-audit-table` with sticky header, hover effects, and cell styling
   - Added `.workout-audit-status-green/yellow/red` for color-coded status indicators

5. Rebuilt CSS from SCSS using `node build-css.mjs`

**Features implemented:**
- Command "Audit exercise names" available in command palette
- Modal scans exercise folder for .md files and compares against CSV exercise names
- Fuzzy matching with similarity scores (0-100%)
- Color-coded status: red (no match/0%), yellow (partial/close match/1-99%), green (exact match/100%)
- Clickable file names open the exercise file
- Results sorted by score (worst matches first)
- Success message when no mismatches found

**Notes for next developer:**
- TypeScript compilation passes
- Pre-existing test failures remain (unrelated to this change):
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- Next task is US-006: Add renameExercise method to DataService
## 2026-01-24 - US-006: Add renameExercise method to DataService

**Status:** Completed

**Changes made:**
1. Added `renameExercise(oldName: string, newName: string): Promise<number>` method to DataService in `app/services/DataService.ts`

**Implementation details:**
- Method reads CSV file using existing `parseCSVLogFile` utility
- Normalizes exercise names for comparison (case-insensitive, trimmed whitespace)
- Updates all matching entries in the CSV to the new exercise name
- Writes back to CSV using existing `entriesToCSVContent` utility
- Clears cache via `clearLogDataCache()` to ensure changes are reflected immediately
- Returns count of updated entries for feedback
- Wraps operations in try-catch with descriptive error messages

**Method signature:**
```typescript
public async renameExercise(
  oldName: string,
  newName: string,
): Promise<number>
```

**Error handling:**
- Throws error if CSV file not found (reuses existing CONSTANTS.WORKOUT.MESSAGES.ERRORS.CSV_NOT_FOUND)
- Catches and wraps any processing errors with descriptive message
- Uses Obsidian's vault.process() API for atomic file updates

**Notes for next developer:**
- TypeScript compilation passes
- Pre-existing test failures remain (unrelated to this change):
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- Next task is US-007: Add Rename in CSV button to Audit Modal
- This method is foundational for the audit modal's rename functionality

## 2026-01-24 - US-007: Add Rename in CSV button to Audit Modal

**Status:** Completed

**Changes made:**
1. Updated `app/constants/Constants.ts`:
   - Added `MODAL.BUTTONS.RENAME_IN_CSV: "Rename in CSV"`
   - Added `MODAL.BUTTONS.RENAME_FILE: "Rename file"`
   - Added `MODAL.NOTICES.AUDIT_RENAME_SUCCESS: "Successfully renamed exercise in CSV"`
   - Added `MODAL.NOTICES.AUDIT_RENAME_ERROR: "Error renaming exercise: "`
   - Added `MODAL.NOTICES.AUDIT_CONFIRM_RENAME: "Are you sure you want to rename this exercise in the CSV?"`

2. Updated `main.ts`:
   - Added public method `renameExercise(oldName: string, newName: string): Promise<number>`
   - Method wraps `dataService.renameExercise()` to expose functionality to modals
   - Follows same pattern as other public methods (deleteWorkoutLogEntry, updateWorkoutLogEntry, etc.)

3. Updated `app/features/modals/AuditExerciseNamesModal.ts`:
   - Added "Actions" column header to audit results table
   - Added "Rename in CSV" button to each mismatch row (only shown for valid matches with score > 0)
   - Added `handleRenameInCSV()` method that:
     - Shows confirmation dialog with "oldName → newName" preview using browser's confirm()
     - Calls `plugin.renameExercise()` to update CSV
     - Displays success message with count of updated entries (e.g., "Successfully renamed exercise in CSV (3 entries updated)")
     - Refreshes modal automatically by calling `scanExerciseFiles()` and `renderResults()`
     - Handles errors gracefully with error notices

**Features implemented:**
- "Rename in CSV" button appears in Actions column for each mismatch with a valid match (score > 0)
- Confirmation dialog shows clear preview: "oldName" → "newName"
- Success message indicates how many CSV entries were updated
- Modal refreshes automatically after rename to show updated audit results
- Button only appears when there's a valid match to rename to (not for "No match found" entries)
- Error handling with user-friendly error messages

**Notes for next developer:**
- TypeScript compilation passes
- Pre-existing test failures remain (unrelated to this change):
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- Next task is US-008: Add Rename File button to Audit Modal
- The rename functionality integrates seamlessly with the existing audit modal UI

## 2026-01-24 - US-008: Add Rename File button to Audit Modal

**Status:** Completed

**Changes made:**
1. Updated `app/constants/Constants.ts`:
   - Added `MODAL.NOTICES.AUDIT_RENAME_FILE_SUCCESS: "Successfully renamed exercise file"`
   - Added `MODAL.NOTICES.AUDIT_RENAME_FILE_ERROR: "Error renaming file: "`
   - Added `MODAL.NOTICES.AUDIT_CONFIRM_RENAME_FILE: "Are you sure you want to rename this file?"`

2. Updated `app/features/modals/AuditExerciseNamesModal.ts`:
   - Modified Actions column to use flexbox layout with 8px gap for button spacing
   - Added "Rename File" button next to "Rename in CSV" button in each mismatch row
   - Both buttons only appear when there's a valid match to rename to (score > 0)
   - Added `handleRenameFile()` method that:
     - Shows confirmation dialog with "oldFileName.md → newFileName.md" preview using browser's confirm()
     - Calculates new file path by replacing old filename with CSV exercise name
     - Uses `app.vault.rename()` API to rename the exercise file
     - Displays success message on completion
     - Refreshes modal automatically by calling `scanExerciseFiles()` and `renderResults()`
     - Handles errors gracefully with error notices

**Features implemented:**
- "Rename File" button appears in Actions column for each mismatch with a valid match (score > 0)
- Confirmation dialog shows clear preview: "oldFileName.md" → "newFileName.md"
- Uses Obsidian's vault.rename() API for file operations
- Success/error messages guide the user through the operation
- Modal refreshes automatically after rename to show updated audit results
- Button only appears when there's a valid match (not for "No match found" entries)
- Both rename buttons (CSV and File) are displayed side-by-side with proper spacing

**Notes for next developer:**
- TypeScript compilation passes
- Pre-existing test failures remain (unrelated to this change):
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- All user stories in the PRD are now complete
- The audit modal now provides comprehensive bidirectional rename functionality: rename CSV to match files OR rename files to match CSV

## 2026-01-24 - Phase 2 Core Features - US-001: Configure Exercise Block Template in Settings

**Status:** Completed

**Changes made:**
1. Updated `app/types/WorkoutLogData.ts`:
   - Added `exerciseBlockTemplate: string` field to `WorkoutChartsSettings` interface
   - Added default template to `DEFAULT_SETTINGS` with placeholders: {{exercise}}, {{duration}}, {{workout}}, {{preset}}
   - Default template includes markdown heading, workout-timer code block, and workout-log code block

2. Updated `app/constants/Constants.ts`:
   - Added `SETTINGS.LABELS.EXERCISE_BLOCK_TEMPLATE: "Exercise block template"`
   - Added `SETTINGS.DESCRIPTIONS.EXERCISE_BLOCK_TEMPLATE` with placeholder documentation
   - Added `SETTINGS.SECTIONS.TEMPLATES: "Templates"`

3. Updated `app/features/settings/WorkoutChartsSettings.ts`:
   - Added `renderTemplatesSection()` method to display Templates section
   - Added textarea setting for exercise block template with 10 rows, 50 cols
   - Template persists via plugin.saveSettings() on change

**Features implemented:**
- New "Templates" section in settings tab
- Exercise Block Template textarea with default template pre-filled
- Description shows available placeholders: {{exercise}}, {{duration}}, {{workout}}, {{preset}}
- Template persists across plugin reloads via settings

**Notes for next developer:**
- TypeScript compilation passes (`npm run build`)
- Pre-existing test failures remain (unrelated to this change):
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- Next task is US-002: Add Exercise Block Command with Modal
- The template is now configurable but not yet used - US-002 will implement the command to insert exercise blocks using this template

## 2026-01-24 - Phase 2 Core Features - US-002: Add Exercise Block Command with Modal

**Status:** Completed

**Changes made:**
1. Updated `app/constants/Constants.ts`:
   - Added `COMMANDS.ADD_EXERCISE_BLOCK: "Add exercise block"`
   - Added `MODAL.TITLES.ADD_EXERCISE_BLOCK: "Add exercise block"`
   - Added `MODAL.BUTTONS.INSERT_EXERCISE_BLOCK: "Insert"`
   - Added `MODAL.NOTICES.EXERCISE_BLOCK_INSERTED: "✅ Exercise block inserted successfully!"`
   - Added `MODAL.LABELS.TIMER_DURATION: "Timer duration (seconds):"`
   - Added `MODAL.LABELS.TIMER_PRESET: "Timer preset:"`
   - Added `MODAL.LABELS.WORKOUT_FILE: "Workout file:"`

2. Created `app/features/modals/AddExerciseBlockModal.ts`:
   - Extends `BaseInsertModal` for consistent modal behavior
   - Implements `ExerciseAutocomplete` component for exercise name input with autocomplete
   - Includes timer preset dropdown (only shown if presets exist in settings)
   - Sets default timer preset from settings if configured
   - Includes timer duration input (default 90 seconds)
   - Includes workout file selector that defaults to current file
   - `generateCode()` method parses template from `plugin.settings.exerciseBlockTemplate`
   - Replaces all placeholders: {{exercise}}, {{duration}}, {{workout}}, {{preset}}
   - Validates exercise name is provided before generating code

3. Updated `app/services/CommandHandlerService.ts`:
   - Imported `AddExerciseBlockModal`
   - Registered `add-exercise-block` command that opens the modal

**Features implemented:**
- Command "Add exercise block" available in command palette
- Modal with three sections: Exercise, Timer, Workout
- Exercise section uses ExerciseAutocomplete for smart exercise selection
- Timer section shows preset dropdown (if presets exist) with default preset pre-selected
- Timer section includes duration input field
- Workout section has file selector defaulting to current file
- Insert button parses template from settings and replaces placeholders
- Template placeholders support: {{exercise}}, {{duration}}, {{workout}}, {{preset}}
- Validation ensures exercise name is provided

**Notes for next developer:**
- TypeScript compilation passes (`npm run build`)
- Pre-existing test failures remain (unrelated to this change):
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- Next task is US-003: Add targetWeight and targetReps parameters to workout-log
- The exercise block template is fully functional and can be customized in settings
- The modal follows the same pattern as other insert modals (InsertTimerModal, InsertChartModal)

## 2026-01-24 - Phase 2 Core Features - US-003: Add targetWeight and targetReps parameters to workout-log

**Status:** Completed

**Changes made:**
1. Updated `app/types/TableTypes.ts`:
   - Added `targetWeight?: number` optional parameter to `EmbeddedTableParams` interface
   - Added `targetReps?: number` optional parameter to `EmbeddedTableParams` interface

2. Updated `app/types/WorkoutLogData.ts`:
   - Added `weightIncrement: number` field to `WorkoutChartsSettings` interface
   - Added `weightIncrement: 2.5` to `DEFAULT_SETTINGS` (2.5kg default increment)

3. Updated `app/constants/Constants.ts`:
   - Added `SETTINGS.LABELS.WEIGHT_INCREMENT: "Weight increment (kg)"`
   - Added `SETTINGS.DESCRIPTIONS.WEIGHT_INCREMENT` with explanation of progressive overload
   - Added `SETTINGS.SECTIONS.PROGRESSIVE_OVERLOAD: "Progressive overload"`

4. Updated `app/features/settings/WorkoutChartsSettings.ts`:
   - Added `renderProgressiveOverloadSection()` method to display Progressive Overload section
   - Added text input for weight increment with validation (must be positive number)
   - Setting persists via plugin.saveSettings() on change
   - Section added after Templates section in settings display

**Parameter parsing:**
- Parameters are automatically parsed by existing `parseCodeBlockParams()` method in `CodeBlockProcessorService`
- Method already handles number parsing, so `targetWeight` and `targetReps` are correctly parsed as numbers
- No changes needed to parsing logic - it just works!

**Usage example:**
```
workout-log
exercise: Bench Press
targetWeight: 100
targetReps: 5
```

**Notes for next developer:**
- TypeScript compilation passes (`npm run build`)
- Pre-existing test failures remain (unrelated to this change):
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- Next task is US-004: Display target header in workout log
- The parameters are now available in `EmbeddedTableParams` and ready to be used for displaying target information
- The weightIncrement setting is available in `plugin.settings.weightIncrement` for future progression calculations

## 2026-01-24 - Phase 2 Core Features - US-004: Display target header in workout log

**Status:** Completed

**Changes made:**
1. Updated `app/constants/Constants.ts`:
   - Added `TARGET_PREFIX: "Target:"` to `CONSTANTS.WORKOUT.LABELS.TABLE`

2. Updated `app/views/EmbeddedTableView.ts`:
   - Added `renderTargetHeader()` private method to render target header when targetWeight or targetReps is set
   - Method renders a div with class `workout-target-header` containing formatted target text
   - Header format: "Target: {weight}kg × {reps} reps" (or partial if only one is set)
   - Header is rendered between Add Log button and table container in `renderTableContentOptimized()`
   - Only renders when at least one of targetWeight or targetReps is defined

3. Updated `app/styles/_table.scss`:
   - Added `.workout-target-header` styling with:
     - Padding and margins for spacing
     - Subtle background color using `var(--background-secondary)`
     - Border-left accent using `var(--text-accent)`
     - Centered text with medium font weight
     - Border radius for rounded corners
   - Built CSS from SCSS using `node build-css.mjs`

**Features implemented:**
- Target header displays when targetWeight or targetReps parameters are set in workout-log code blocks
- Header format shows weight and/or reps in clear, readable format
- Header styled with Obsidian CSS variables for theme consistency
- Header positioned between exercise name (Add Log button) and table
- Supports partial display (weight only, reps only, or both)

**Usage example:**
```
workout-log
exercise: Bench Press
targetWeight: 100
targetReps: 5
```
This will display: "Target: 100kg × 5 reps" above the workout log table.

**Notes for next developer:**
- TypeScript compilation passes (`npm run build`)
- Pre-existing test failures remain (unrelated to this change):
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- Next task is US-005: Display target progress indicator
- The target header is now displayed, ready for US-005 to add progress bar visualization

## 2026-01-24 - Phase 2 Core Features - US-005: Display target progress indicator

**Status:** Completed

**Changes made:**
1. Updated `app/views/EmbeddedTableView.ts`:
   - Modified `renderTargetHeader()` to accept `filteredData` parameter and pass it to progress bar renderer
   - Modified `renderTableContentOptimized()` to pass filtered data to `renderTargetHeader()`
   - Added `renderProgressBar()` method that renders progress bar when both targetWeight and targetReps are set
   - Added `calculateBestRepsAtWeight()` method to find best (maximum) reps at target weight from filtered data
   - Progress bar only shown when there is data at target weight
   - Progress percent calculated as `(bestReps / targetReps) * 100`, capped at 100%

2. Updated `app/styles/_table.scss`:
   - Added `.workout-target-text` styling to display target text as block with margin
   - Added `.workout-progress-container` for progress bar container
   - Added `.workout-progress-bar` with background, border-radius, and cursor styling
   - Added `.workout-progress-fill` with smooth transition animations
   - Added color coding classes using Obsidian CSS variables:
     - `.workout-progress-low` (red) for 0-50% progress
     - `.workout-progress-medium` (yellow) for 50-90% progress
     - `.workout-progress-high` (green) for 90-100% progress
     - `.workout-progress-complete` (bright green/accent) for 100%+ progress
   - Built CSS from SCSS using `node build-css.mjs`

**Features implemented:**
- Progress bar displays in target header when both targetWeight and targetReps are set
- Calculates progress by finding best reps achieved at target weight
- Progress bar fills proportionally based on (bestReps / targetReps) * 100
- Color coding changes based on progress: red (0-50%), yellow (50-90%), green (90-100%), bright green (100%+)
- Tooltip shows exact numbers: "Best: X reps / Target: Y reps"
- Progress bar styled with Obsidian CSS variables for theme consistency
- Smooth transitions for width and color changes
- Only shows progress bar when user has data at target weight (gracefully handles empty state)

**Notes for next developer:**
- TypeScript compilation passes (`npm run build`)
- Pre-existing test failures remain (unrelated to this change):
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- Next task is US-006: Target achievement notification badge
- The progress bar provides visual feedback on progression, preparing the groundwork for achievement notifications
- Progress calculation is efficient since it uses already-filtered data passed from parent method

## 2026-01-24 - Phase 2 Core Features - US-006: Target achievement notification badge

**Status:** Completed

**Changes made:**
1. Updated `app/types/WorkoutLogData.ts`:
   - Added `achievedTargets: Record<string, number>` field to `WorkoutChartsSettings` interface
   - Stores the target weight value (not boolean) to track which specific weight was dismissed
   - Added `achievedTargets: {}` to `DEFAULT_SETTINGS`

2. Updated `app/constants/Constants.ts`:
   - Added `MODAL.NOTICES.TARGET_ACHIEVED: "Target Reached! Consider increasing weight"`
   - Added `MODAL.NOTICES.TARGET_DISMISSED: "Achievement badge dismissed"`

3. Updated `app/views/EmbeddedTableView.ts`:
   - Modified `renderTableContentOptimized()` to call `renderAchievementBadge()` when both targetWeight and targetReps are set
   - Added `renderAchievementBadge()` method that:
     - Checks if target is achieved using `checkTargetAchieved()` method
     - Generates unique achievement key: `${exercise}:${targetWeight}`
     - Checks if badge was dismissed for this specific target weight
     - Renders badge with text "Target Reached! Consider increasing weight"
     - Includes dismiss button (×) that stores target weight in achievedTargets[exercise]
     - Badge removed immediately on dismiss, state persists via plugin.saveSettings()
   - Added `checkTargetAchieved()` method that:
     - Filters data to entries at target weight
     - Finds most recent entry at target weight (sorted by timestamp)
     - Returns true if latest entry's reps >= targetReps
     - Handles edge cases with try-catch

4. Updated `app/styles/_table.scss`:
   - Added `.workout-achievement-badge` styling with:
     - Flexbox layout with space-between for text and dismiss button
     - Green background using `var(--text-success)`
     - White text using `var(--text-on-accent)`
     - Border-left accent using `var(--interactive-accent)`
     - Box shadow and rounded corners
     - Slide-in animation (fadeIn from top)
   - Added `.workout-achievement-text` for badge text styling
   - Added `.workout-achievement-dismiss` for dismiss button styling with hover opacity
   - Added `@keyframes slideIn` animation for smooth appearance
   - Built CSS from SCSS using `node build-css.mjs`

**Key implementation details:**
- Achievement key uses `${exercise}:${targetWeight}` format so badge reappears when targetWeight changes
- Badge only shows when latest (most recent) entry at targetWeight meets or exceeds targetReps
- Dismiss button stores the specific target weight value, not just a boolean flag
- This design ensures the badge reappears when user increases target weight for progression
- Badge appears below target header and progress bar, above workout log table

**Notes for next developer:**
- TypeScript compilation passes (`npm run build`)
- Pre-existing test failures remain (unrelated to this change):
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- Next task is US-007: Suggest next weight progression
- US-007 will add a suggestion button to the achievement badge with the next weight value
- The achievement badge provides the foundation for the weight progression suggestion feature

## 2026-01-24 - Phase 2 Core Features - US-007: Suggest next weight progression

**Status:** Completed

**Changes made:**
1. Updated `app/constants/Constants.ts`:
   - Added `MODAL.NOTICES.SUGGESTED_NEXT_WEIGHT: "Suggested next:"`
   - Added `MODAL.NOTICES.CONFIRM_UPDATE_TARGET: "Update target weight to"`
   - Added `MODAL.BUTTONS.UPDATE_TARGET_WEIGHT: "Update target"`

2. Updated `app/views/EmbeddedTableView.ts`:
   - Modified `renderAchievementBadge()` to call `renderWeightSuggestion()` method
   - Added `renderWeightSuggestion()` method that:
     - Calculates suggested next weight as currentWeight + weightIncrement (from settings)
     - Displays suggestion text "Suggested next: Xkg" next to achievement badge
     - Creates "Update target" button with click handler
     - Shows confirmation dialog before updating: "Update target weight to Xkg?"
   - Added `updateTargetWeight()` method that:
     - Gets active MarkdownView editor
     - Parses editor content line by line to find the workout-log code block
     - Identifies correct code block by matching exercise name
     - Updates targetWeight parameter in the code block
     - Refreshes table to show updated target
     - Uses Obsidian's editor.setValue() API for atomic updates

3. Updated `app/styles/_table.scss`:
   - Added `.workout-weight-suggestion` with flexbox layout for suggestion container
   - Added `.workout-suggestion-text` styling for suggestion text (smaller, slightly transparent)
   - Added `.workout-update-target-button` with:
     - Interactive accent background color
     - Hover effects (translateY, shadow)
     - Active state animation
     - Smooth transitions
   - Built CSS from SCSS using `node build-css.mjs`

**Features implemented:**
- Weight suggestion displays next to achievement badge when target is reached
- Suggestion calculates next weight using weightIncrement from settings
- "Update target" button opens confirmation dialog
- Confirmation shows clear message: "Update target weight to Xkg?"
- On confirm, updates targetWeight parameter in code block
- Table refreshes automatically after update to show new target
- Button styled with hover and active states using Obsidian CSS variables

**Notes for next developer:**
- TypeScript compilation passes (`npm run build`)
- Pre-existing test failures remain (unrelated to this change):
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- Next task is US-008: Quick log with previous values and adjust buttons
- The weight progression feature provides a smooth user flow: achieve target → see suggestion → click to update → continue training
- The updateTargetWeight() method uses a line-by-line parsing approach to safely update only the matching code block

## 2026-01-24 - Phase 2 Core Features - US-008: Quick log with previous values and adjust buttons

**Status:** Completed

**Changes made:**
1. Updated `app/constants/Constants.ts`:
   - Added `MODAL.BUTTONS.REPEAT_LAST: "Repeat Last"`
   - Added `MODAL.BUTTONS.ADJUST_PLUS: "+"`
   - Added `MODAL.BUTTONS.ADJUST_MINUS: "-"`

2. Modified `app/features/modals/CreateLogModal.ts`:
   - Added `initialValues?: Partial<LogFormData>` parameter to constructor
   - Modified `shouldPreFillForm()` to return true when initialValues provided
   - Modified `getPreFillData()` to return initialValues

3. Modified `app/features/modals/base/BaseLogModal.ts`:
   - Replaced simple reps input with field-with-adjust structure
   - Added quick adjust buttons for reps: "+1" and "-1"
   - Replaced simple weight input with field-with-adjust structure
   - Added quick adjust buttons for weight: "+{increment}" and "-{increment}"
   - Weight buttons use `plugin.settings.weightIncrement` value
   - Buttons update input values with proper bounds (min 0 for both)

4. Updated `app/components/organism/LogCallouts.ts`:
   - Added import for `WorkoutLogData` type
   - Added `renderRepeatLastButton()` method that:
     - Creates button with class `workout-repeat-last-button`
     - Opens CreateLogModal with initialValues from latestEntry
     - Pre-fills exercise, weight, reps, workout, and notes fields

5. Modified `app/views/EmbeddedTableView.ts`:
   - Wrapped Add Log button in a button container div
   - Added conditional rendering of Repeat Last button when entries exist
   - Uses first entry from filteredData as latest entry

6. Updated `app/styles/_modal.scss`:
   - Added `.workout-field-with-adjust` for flex container
   - Added `.workout-field-label` for field labels
   - Added `.workout-input-with-adjust` for input + buttons layout
   - Added `.workout-adjust-buttons` for button group
   - Added `.workout-adjust-btn` with hover and active states
   - Added color coding: plus buttons green, minus buttons red

7. Updated `app/styles/components/_buttons.scss`:
   - Added `workout-repeat-last-button` to button styling
   - Modified `&-container` to use flexbox with gap
   - Added specific styling for repeat-last-button with secondary style

8. Rebuilt CSS from SCSS using `node build-css.mjs`

**Features implemented:**
- "Repeat Last" button appears in workout-log table header when entries exist
- Button opens CreateLogModal pre-filled with latest entry values (exercise, weight, reps, workout, notes)
- Quick adjust buttons for reps field: "+1" and "-1"
- Quick adjust buttons for weight field: "+{increment}" and "-{increment}" using weightIncrement setting
- Buttons positioned next to input fields in horizontal layout
- Compact button styling with Obsidian CSS variables
- Hover effects and color coding for visual feedback

**Notes for next developer:**
- TypeScript compilation passes (`npm run build`)
- Pre-existing test failures remain (unrelated to this change):
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- All user stories (US-001 through US-008) in Phase 2 Core Features PRD are now complete
- The quick log feature significantly speeds up workout logging by pre-filling previous values
- Quick adjust buttons allow for small incremental changes without manual typing
- Feature follows existing modal patterns and integrates seamlessly with the table view

## 2026-01-24 - Memory Leak Fixes PRD - US-001: Track and destroy Chart.js instances

**Status:** Completed

**Changes made:**
1. Updated `app/features/charts/components/ChartRenderer.ts`:
   - Added `private static chartInstances: Map<string, Chart>` to track all Chart.js instances
   - Added `generateChartId()` private method that creates unique IDs based on:
     - Container element ID if available
     - Hash of chart parameters (exercise, workout, type, title) as fallback
   - Modified `renderChart()` method to:
     - Generate unique chart ID for each chart
     - Check if chart with same ID already exists
     - Call `destroy()` on existing chart before creating new one
     - Store new chart instance in the Map with its ID
   - Added `destroyAllCharts()` public static method that:
     - Iterates through all tracked chart instances
     - Calls `destroy()` on each chart
     - Clears the chartInstances Map

2. Created comprehensive unit tests in `app/features/charts/components/__tests__/ChartRenderer.test.ts`:
   - Mocked Chart.js, ChartContainer, and Chart config modules to run in Node environment
   - Test suite covers:
     - Chart instance creation
     - Destroying existing chart before creating new one with same ID
     - Tracking multiple charts with different IDs
     - destroyAllCharts() destroying all tracked instances
     - Clearing the Map after destroyAllCharts()
     - Chart ID generation using container ID
     - Chart ID generation using hash when no container ID
   - All 7 tests passing

**Implementation notes:**
- Chart tracking uses Map for O(1) lookup and cleanup performance
- Unique ID generation ensures charts are properly identified even without container IDs
- The destroy() method is called before creating new charts to prevent memory leaks
- destroyAllCharts() is exported for use in plugin lifecycle cleanup (will be used in US-006)

**Notes for next developer:**
- TypeScript compilation passes (`npm run build`)
- All ChartRenderer tests pass (7/7)
- Pre-existing test failures remain (unrelated to this change):
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- Next task is US-002: Add cleanup method to EmbeddedChartView
- The chartInstances Map is ready to be used in plugin unload lifecycle (US-006)
- This change is critical for preventing memory leaks when users have multiple workout charts open

## 2026-01-24 - Memory Leak Fixes PRD - US-002: Add cleanup method to EmbeddedChartView

**Status:** Completed

**Changes made:**
1. Updated `app/views/EmbeddedChartView.ts`:
   - Added public `cleanup()` method with JSDoc documentation
   - Method calls `ChartRenderer.destroyAllCharts()` to destroy all Chart.js instances
   - Includes try-catch error handling for safe cleanup
   - Includes debug logging for cleanup operations
   - Method is public so it can be called from plugin lifecycle (main.ts onunload)

**Implementation details:**
- Cleanup method is straightforward since ChartRenderer handles all chart instance tracking
- EmbeddedChartView has no internal state to clear beyond the charts
- Error handling ensures cleanup failures don't crash the plugin
- Debug logging helps track cleanup operations during development

**Notes for next developer:**
- TypeScript compilation passes (`npm run build`)
- All tests pass (27/29 pass, 2 pre-existing failures unrelated to this change):
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- Next task is US-003: Refactor EmbeddedTableView with MarkdownRenderChild
- The cleanup() method is ready to be called from main.ts onunload() in US-006
- This completes the chart view memory leak prevention - charts will be properly destroyed on plugin unload

## 2026-01-24 - Memory Leak Fixes PRD - US-003: Refactor EmbeddedTableView with MarkdownRenderChild

**Status:** Completed

**Changes made:**
1. Created `TableRenderChild` class in `app/views/EmbeddedTableView.ts`:
   - Extends `MarkdownRenderChild` for proper lifecycle management
   - Added `abortController: AbortController` property for event listener cleanup
   - Implemented `onload()` method (placeholder for lifecycle hook)
   - Implemented `onunload()` method that calls `this.abortController.abort()`
   - Added `getSignal()` method to expose AbortSignal for event listener registration

2. Refactored `EmbeddedTableView` class:
   - Added `renderChildren: TableRenderChild[]` property to track all render children
   - Modified `renderTableContentOptimized()` to create TableRenderChild instance
   - Passed AbortSignal to all components that register event listeners
   - Called `renderChild.load()` after rendering to activate the render child

3. Updated `TableRenderer.renderTable()` and `applyRowGroupingOptimized()` in `app/features/tables/components/TableRenderer.ts`:
   - Added optional `signal?: AbortSignal` parameter
   - Passed signal through to `TableActions.renderActionButtons()`

4. Updated `TableActions.renderActionButtons()` in `app/features/tables/components/TableActions.ts`:
   - Added optional `signal?: AbortSignal` parameter
   - Modified edit and delete button event listeners to use `{ signal }` option
   - Event listeners are now properly cleaned up when AbortController is aborted

5. Updated `LogCallouts.renderAddLogButton()` and `renderRepeatLastButton()` in `app/components/organism/LogCallouts.ts`:
   - Added optional `signal?: AbortSignal` parameter to both methods
   - Passed signal to `Button.onClick()` for proper event listener cleanup

6. Updated `Button.onClick()` in `app/components/atoms/Button.ts`:
   - Added optional `signal?: AbortSignal` parameter
   - Modified addEventListener to use `{ signal }` option when signal is provided

7. Updated achievement badge and weight suggestion in `EmbeddedTableView`:
   - Modified `renderAchievementBadge()` to accept and use signal parameter
   - Modified `renderWeightSuggestion()` to accept and use signal parameter
   - Both dismiss button and update button now use AbortSignal for cleanup

**Implementation details:**
- All event listeners in workout log tables now use AbortSignal for automatic cleanup
- TableRenderChild instances are created per table render and tracked in renderChildren array
- When tables are refreshed or removed, onunload() is called, aborting all event listeners
- This prevents memory leaks from zombie event listeners accumulating over time

**Notes for next developer:**
- TypeScript compilation passes (`npm run build`)
- All tests pass (27/29 pass, 2 pre-existing failures unrelated to this change):
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- Next task is US-004: Add cleanup method to EmbeddedTableView
- The TableRenderChild pattern provides a foundation for proper cleanup in US-004
- All event listeners in tables now have proper lifecycle management using AbortController

## 2026-01-24 - Memory Leak Fixes PRD - US-004: Add cleanup method to EmbeddedTableView

**Status:** Completed

**Changes made:**
1. Updated `app/views/EmbeddedTableView.ts`:
   - Added public `cleanup()` method with JSDoc documentation
   - Method iterates through all `renderChildren` (TableRenderChild instances)
   - Calls `unload()` on each TableRenderChild, which triggers their `onunload()` method
   - This aborts all AbortControllers associated with event listeners
   - Clears the `renderChildren` array to release references
   - Includes try-catch error handling for safe cleanup
   - Includes debug logging for cleanup operations

**Implementation details:**
- Cleanup method properly manages the lifecycle of all TableRenderChild instances
- Each TableRenderChild has its own AbortController that gets aborted on unload
- This cascades cleanup to all event listeners registered with AbortSignal
- Array is cleared after cleanup to prevent memory leaks from retained references
- Method is public so it can be called from plugin lifecycle (main.ts onunload)

**Notes for next developer:**
- TypeScript compilation passes (`npm run build`)
- All tests pass (27/29 pass, 2 pre-existing failures unrelated to this change):
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- Next task is US-005: Add cleanup method to EmbeddedDashboardView
- The cleanup() method is ready to be called from main.ts onunload() in US-006
- This completes the table view memory leak prevention - event listeners will be properly cleaned up on plugin unload

## 2026-01-24 - Memory Leak Fixes PRD - US-005: Add cleanup method to EmbeddedDashboardView

**Status:** Completed

**Changes made:**
1. Updated `app/views/EmbeddedDashboardView.ts`:
   - Added public `cleanup()` method with comprehensive JSDoc documentation
   - Method includes try-catch error handling for safe cleanup
   - Includes debug logging for cleanup operations
   - Currently no internal state to clear, but method provides:
     - Consistency with other view cleanup patterns (EmbeddedChartView, EmbeddedTableView)
     - Future-proofing if dashboard adds stateful components (event listeners, timers, AbortControllers)
     - Plugin lifecycle compliance for onunload() hook

**Implementation details:**
- Unlike EmbeddedTableView (which manages TableRenderChild instances and AbortControllers) and EmbeddedChartView (which manages Chart.js instances), EmbeddedDashboardView currently delegates all rendering to stateless widget components
- Widgets (SummaryWidget, QuickStatsCards, VolumeAnalytics, etc.) handle their own rendering without maintaining long-lived resources
- The cleanup() method serves as a placeholder and consistency interface, ready for future dashboard features that may require cleanup
- Error handling ensures cleanup failures don't crash the plugin during unload

**Notes for next developer:**
- TypeScript compilation passes (`npm run build`)
- All tests pass (27/29 pass, 2 pre-existing failures unrelated to this change):
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- Next task is US-006: Complete plugin lifecycle cleanup in main.ts
- The cleanup() method is ready to be called from main.ts onunload() in US-006
- All three view classes (EmbeddedChartView, EmbeddedTableView, EmbeddedDashboardView) now have cleanup() methods
- This provides a consistent cleanup interface for the plugin lifecycle

## 2026-01-24 - Memory Leak Fixes PRD - US-006: Complete plugin lifecycle cleanup in main.ts

**Status:** Completed

**Changes made:**
1. Updated `main.ts`:
   - Added import for `ChartRenderer` to access static `destroyAllCharts()` method
   - Completely rewrote `onunload()` method with comprehensive cleanup logic
   - Added detailed JSDoc-style comment block documenting cleanup order and rationale

**Cleanup order implemented:**
1. **Active timers**: Clean up all active timer views via `destroy()` and clear the Map
2. **Embedded views**: Call `cleanup()` on chart, table, and dashboard views
   - Chart view cleanup destroys all Chart.js instances
   - Table view cleanup aborts all AbortControllers (event listener cleanup)
   - Dashboard view cleanup provides consistent interface for future extensions
3. **Data cache**: Clear cached workout data via `dataService.clearLogDataCache()` to release memory
4. **Chart.js instances**: Additional safety net via `ChartRenderer.destroyAllCharts()`
5. **Service references**: Nullify service references to allow garbage collection

**Implementation details:**
- Uses optional chaining (`?.`) for view cleanup to handle any edge cases
- Comprehensive comment block explains cleanup order and what memory leaks are prevented
- Cleanup order is deliberate: component-level → view-level → data-level → instance-level → reference-level
- Service nullification uses `null!` assertion (non-null assertion operator) for type safety

**Memory leak prevention:**
- Chart.js instances accumulating in memory
- Event listeners not being properly removed (zombie listeners)
- Cached data consuming excessive memory
- Service references preventing garbage collection

**Notes for next developer:**
- TypeScript compilation passes (`npm run build`)
- All tests pass (27/29 pass, 2 pre-existing failures unrelated to this change):
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- Next task is US-007: Add recursion protection to addWorkoutLogEntry
- The plugin lifecycle cleanup is now complete and comprehensive
- All cleanup methods from US-001 through US-005 are now integrated into the plugin lifecycle
- This completes the critical memory leak prevention infrastructure

## 2026-01-24 - Memory Leak Fixes PRD - US-007: Add recursion protection to addWorkoutLogEntry

**Status:** Completed

**Changes made:**
1. Updated `app/services/DataService.ts`:
   - Added `private readonly MAX_RETRIES = 1` constant to DataService class
   - Modified `addWorkoutLogEntry()` to accept optional `retryCount` parameter with default value 0
   - Added recursion protection check before recursive call
   - Throws descriptive error with CSV file path when MAX_RETRIES exceeded
   - Displays user-friendly Notice when CSV creation fails persistently
   - Increments retryCount on recursive call: `addWorkoutLogEntry(entry, retryCount + 1)`

2. Created `app/services/__tests__/DataService.test.ts`:
   - Comprehensive test suite for recursion protection feature
   - 5 test cases covering:
     - Successful entry addition when CSV file exists
     - CSV file creation and retry when file doesn't exist
     - Error thrown after MAX_RETRIES exceeded
     - Process not called when recursion limit reached
     - CSV path included in error message
   - Mocked Obsidian API (App, Vault, TFile, Notice) for isolated unit testing
   - All tests passing (5/5)

3. Updated `jest.config.js`:
   - Removed obsidian module mapping to allow virtual mocking in tests
   - Maintains @app path alias for module resolution

**Implementation details:**
- Recursion protection prevents infinite stack overflow when CSV file creation fails repeatedly
- MAX_RETRIES = 1 allows one retry attempt (initial call + 1 retry)
- Error message includes actual CSV file path for easier debugging
- Notice provides user-friendly feedback when operation fails
- JSDoc documentation updated to include retryCount parameter

**Notes for next developer:**
- TypeScript compilation passes (`npx tsc -noEmit -skipLibCheck`)
- All DataService tests pass (5/5)
- Pre-existing test failures remain (unrelated to this change):
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- Next task is US-008: Strengthen CSV parsing validation
- This critical stability fix prevents stack overflow crashes when users have invalid CSV paths
- The recursion protection provides clear error messages to help users fix configuration issues

