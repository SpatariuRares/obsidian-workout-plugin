# Ralph Progress Log

## 2026-01-24 - US-001: Add TimerPresetConfig type and settings field

**Status:** Completed

**Changes made:**
1. Added `TimerPresetConfig` interface to `app/types/TimerTypes.ts` with fields:
   - `name: string`
   - `type: TIMER_TYPE`
   - `duration: number`
   - `showControls: boolean`
   - `autoStart: boolean`
   - `sound: boolean`
   - `intervalTime?: number` (optional, for interval timers)
   - `rounds?: number` (optional, for interval timers)

2. Exported `TimerPresetConfig` from `app/types/index.ts`

3. Updated `WorkoutChartsSettings` in `app/types/WorkoutLogData.ts` with:
   - `timerPresets: Record<string, TimerPresetConfig>`
   - `defaultTimerPreset: string | null`

4. Updated `DEFAULT_SETTINGS` in `app/types/WorkoutLogData.ts` with:
   - `timerPresets: {}`
   - `defaultTimerPreset: null`

**Notes for next developer:**
- TypeScript compilation passes
- Pre-existing test failures unrelated to this change:
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- Next task is US-002: Add Timer Presets UI to settings tab

## 2026-01-24 - US-002: Add Timer Presets UI to settings tab

**Status:** Completed

**Changes made:**
1. Updated `app/constants/Constants.ts` with new settings labels, descriptions, buttons, and messages for timer presets:
   - Labels: TIMER_PRESETS, DEFAULT_TIMER_PRESET, PRESET_NAME, PRESET_TYPE, PRESET_DURATION, etc.
   - Descriptions: TIMER_PRESETS, DEFAULT_TIMER_PRESET, NO_PRESETS
   - Sections: TIMER_PRESETS
   - Buttons: ADD_PRESET, DELETE_PRESET, SAVE_PRESET, CANCEL
   - Messages: PRESET_NAME_REQUIRED, PRESET_NAME_EXISTS, PRESET_DELETED, PRESET_SAVED, CONFIRM_DELETE_PRESET

2. Completely rewrote `app/features/settings/WorkoutChartsSettings.ts` to include Timer Presets UI:
   - Added `renderTimerPresetsSection()` method with section heading
   - Added Default Timer Preset dropdown with "None" option + all existing presets
   - Added `renderPresetsList()` to display all configured presets with edit/delete buttons
   - Added `renderPresetItem()` to display individual preset with formatted details
   - Added `formatPresetDetails()` to format preset config as readable string
   - Added `showPresetEditor()` for inline preset editing (supports both create and edit)
   - Added `savePreset()` with name validation and duplicate checking
   - Added `deletePreset()` with cleanup of default preset reference if needed
   - Editor conditionally shows interval-specific fields (intervalTime, rounds) only for interval timer type

**Features implemented:**
- Settings tab includes 'Timer Presets' section
- Can add a new preset with name input and all configuration fields
- Can edit existing presets inline (clicking pencil icon)
- Can delete presets with confirmation dialog
- Default Timer Preset dropdown shows available presets plus 'None' option
- Presets persist across plugin reloads via plugin.saveSettings()
- Dynamic form that shows/hides interval-specific fields based on timer type

**Notes for next developer:**
- TypeScript compilation passes
- Pre-existing test failures remain (unrelated to this change)
- Next task is US-003: Add preset parameter to workout-timer blocks

## 2026-01-24 - US-003: Add preset parameter to workout-timer blocks

**Status:** Completed

**Changes made:**
1. Updated `app/types/TimerTypes.ts`:
   - Added optional `preset?: string` parameter to `EmbeddedTimerParams` interface

2. Updated `app/views/EmbeddedTimerView.ts`:
   - Added import for `TimerPresetConfig`
   - Added `resolveTimerParams()` method that implements parameter resolution:
     - Checks for explicitly specified preset in code block params
     - Falls back to default preset from settings if no explicit preset
     - Merges preset params with explicit params (explicit override preset)
   - Added `presetToParams()` helper to convert TimerPresetConfig to EmbeddedTimerParams
   - Added `filterUndefined()` helper for proper parameter merging
   - Added `renderPresetError()` to display error when preset not found
   - Updated `createTimer()` to use resolved parameters

**Resolution order implemented:**
1. Explicit parameters from code block
2. Parameters from specified preset (if preset parameter provided)
3. Parameters from default preset (if configured in settings)
4. Hardcoded defaults (TIMER_TYPE.COUNTDOWN, 300 seconds, etc.)

**Usage example:**
```
workout-timer
preset: My Rest Timer
duration: 60
```
This will use "My Rest Timer" preset as base, but override duration to 60 seconds.

**Notes for next developer:**
- TypeScript compilation passes
- Pre-existing test failures remain (unrelated to this change):
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- Next task is US-004: Change DEFAULT_EXACT_MATCH to true

## 2026-01-24 - US-004: Change DEFAULT_EXACT_MATCH to true

**Status:** Completed

**Changes made:**
1. Updated `app/constants/Constants.ts`:
   - Added `CONSTANTS.WORKOUT.TABLE.DEFAULTS.EXACT_MATCH = true`
   - Added `CONSTANTS.WORKOUT.SETTINGS.LABELS.DEFAULT_EXACT_MATCH`
   - Added `CONSTANTS.WORKOUT.SETTINGS.DESCRIPTIONS.DEFAULT_EXACT_MATCH`
   - Added `CONSTANTS.WORKOUT.SETTINGS.SECTIONS.FILTERING`

2. Updated `app/types/WorkoutLogData.ts`:
   - Added `defaultExactMatch: boolean` field to `WorkoutChartsSettings` interface
   - Added `defaultExactMatch: true` to `DEFAULT_SETTINGS`

3. Updated `app/features/settings/WorkoutChartsSettings.ts`:
   - Added new "Filtering" section with toggle for "Default exact match" setting
   - Toggle saves to `plugin.settings.defaultExactMatch`

4. Updated `app/features/modals/InsertChartModal.ts`:
   - Changed `exactMatchToggle.checked = true` to use `plugin.settings.defaultExactMatch`

5. Updated `app/features/modals/InsertTableModal.ts`:
   - Changed `exactMatchToggle.checked = true` to use `plugin.settings.defaultExactMatch`

6. Updated `app/features/tables/business/TableConfig.ts`:
   - Changed `exactMatch: false` to `exactMatch: CONSTANTS.WORKOUT.TABLE.DEFAULTS.EXACT_MATCH`

**Features implemented:**
- exactMatch defaults to `true` across the codebase
- New "Filtering" section in settings with "Default exact match" toggle
- Modals use the setting value for their default checkbox state
- Existing code blocks with explicit `exactMatch: false` continue to work unchanged

**Notes for next developer:**
- TypeScript compilation passes
- Pre-existing test failures remain (unrelated to this change):
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- Next task is US-005: Create Audit Exercise Names command and modal

## 2026-01-24 - US-005: Create Audit Exercise Names command and modal

**Status:** Completed

**Changes made:**
1. Created `app/features/modals/AuditExerciseNamesModal.ts`:
   - Extends `ModalBase` for consistent modal behavior
   - `scanExerciseFiles()` method scans exercise folder and compares filenames against CSV exercise names
   - Uses existing `getMatchScore()` utility from `app/utils/utils.ts` for fuzzy matching (0-100 similarity scores)
   - `renderResults()` displays results in a table with columns: File name, CSV exercise, Similarity, Status
   - File names are clickable links that open the exercise file
   - Results sorted by score (worst matches first)
   - Shows success message when no mismatches found

2. Updated `app/constants/Constants.ts`:
   - Added `COMMANDS.AUDIT_EXERCISE_NAMES: "Audit exercise names"`
   - Added `MODAL.TITLES.AUDIT_EXERCISE_NAMES: "Audit exercise names"`
   - Added `MODAL.LABELS.FILE_NAME`, `CSV_EXERCISE`, `SIMILARITY`, `STATUS`
   - Added `MODAL.NOTICES.AUDIT_NO_MISMATCHES` and `AUDIT_SCANNING`

3. Updated `app/services/CommandHandlerService.ts`:
   - Imported `AuditExerciseNamesModal`
   - Registered `audit-exercise-names` command that opens the modal

4. Updated `app/styles/_modal.scss`:
   - Added `.workout-audit-success` styling for success message
   - Added `.workout-audit-table-container` with max-height and scrolling
   - Added `.workout-audit-table` with sticky header, hover effects, and cell styling
   - Added `.workout-audit-status-green/yellow/red` for color-coded status indicators

5. Rebuilt CSS from SCSS using `node build-css.mjs`

**Features implemented:**
- Command "Audit exercise names" available in command palette
- Modal scans exercise folder for .md files and compares against CSV exercise names
- Fuzzy matching with similarity scores (0-100%)
- Color-coded status: red (no match/0%), yellow (partial/close match/1-99%), green (exact match/100%)
- Clickable file names open the exercise file
- Results sorted by score (worst matches first)
- Success message when no mismatches found

**Notes for next developer:**
- TypeScript compilation passes
- Pre-existing test failures remain (unrelated to this change):
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- Next task is US-006: Add renameExercise method to DataService
## 2026-01-24 - US-006: Add renameExercise method to DataService

**Status:** Completed

**Changes made:**
1. Added `renameExercise(oldName: string, newName: string): Promise<number>` method to DataService in `app/services/DataService.ts`

**Implementation details:**
- Method reads CSV file using existing `parseCSVLogFile` utility
- Normalizes exercise names for comparison (case-insensitive, trimmed whitespace)
- Updates all matching entries in the CSV to the new exercise name
- Writes back to CSV using existing `entriesToCSVContent` utility
- Clears cache via `clearLogDataCache()` to ensure changes are reflected immediately
- Returns count of updated entries for feedback
- Wraps operations in try-catch with descriptive error messages

**Method signature:**
```typescript
public async renameExercise(
  oldName: string,
  newName: string,
): Promise<number>
```

**Error handling:**
- Throws error if CSV file not found (reuses existing CONSTANTS.WORKOUT.MESSAGES.ERRORS.CSV_NOT_FOUND)
- Catches and wraps any processing errors with descriptive message
- Uses Obsidian's vault.process() API for atomic file updates

**Notes for next developer:**
- TypeScript compilation passes
- Pre-existing test failures remain (unrelated to this change):
  - `FrontmatterParser.test.ts` - Obsidian module mock configuration issue
  - `FormField.test.ts` - Expects "Exercise Name" but code uses sentence case "Exercise name"
- Next task is US-007: Add Rename in CSV button to Audit Modal
- This method is foundational for the audit modal's rename functionality

